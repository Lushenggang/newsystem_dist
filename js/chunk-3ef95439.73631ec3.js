(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ef95439"],{5603:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"data-component-page"},[a("TreeGrid")],1)},n=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tree-grid",style:{height:t.TableAreaHeight+"px"}},[t.loading?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),a("div",{staticClass:"tree-table"},[a("div",{staticClass:"top-menu"},[a("h1",[t._v("树形组件数据拓展  "),a("Button",{attrs:{type:"info"},on:{click:t.addAdditionalDataFilter}},[t._v("添加新时间段")]),a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning"},on:{click:function(e){t.sort()}}},[t._v("时间段排序")])],1)]),t.additionalDataFiliterList&&t.additionalDataFiliterList.length?a("div",{staticClass:"tabs-area"},[t.loadingData?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),a("Tabs",{attrs:{animated:!1,type:"card"},model:{value:t.nowEditId,callback:function(e){t.nowEditId=e},expression:"nowEditId"}},t._l(t.additionalDataFiliterList,function(e,i){return a("TabPane",{key:i,attrs:{label:e.name,name:e.id}},[a("div",{staticClass:"tool-show"},[a("strong",[t._v("有效期:  ")]),a("span",{directives:[{name:"show",rawName:"v-show",value:3!=e.type,expression:"item.type != 3"}]},[t._v(t._s(t.getDateTime(e.startTime))+"   -   "+t._s(2==e.type?"长期":t.getDateTime(e.endTime)))]),a("span",{directives:[{name:"show",rawName:"v-show",value:3==e.type,expression:"item.type == 3"}]},[t._v("永久")])]),a("div",{staticClass:"tool-menu"},[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"error"},on:{click:function(a){t.handleTabRemove(e.id)}}},[t._v("删除此时间段")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"warning"},on:{click:function(a){t.updateAdditionalDataFilter(e.id)}}},[t._v("修改此时间段设置")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"error"},on:{click:function(a){t.handleColRemove(e.id)}}},[t._v("删除此列")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"warning"},on:{click:function(a){t.editCol(e.id)}}},[t._v("修改此列")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"info"},on:{click:function(a){t.addCol(e.id)}}},[t._v("添加新列")]),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"warning"},on:{click:t.sortCol}},[t._v("列排序")]),a("Button",{attrs:{type:"primary"},on:{click:function(a){t.save(e.id,!0)}}},[t._v("保存")])],1)])})),a("div",{attrs:{id:"grid"}})],1):a("Alert",{attrs:{type:"warning"}},[t._v("未查询到该组件的数据拓展信息，请先"),a("a",{on:{click:t.addAdditionalDataFilter}},[t._v("添加时间段")]),t._v("。")])],1),a("Modal",{attrs:{title:(t.filterTemplate.isEdit?"编辑":"添加新")+"时间段",loading:t.showAdditionalDataFilterModelLoading},on:{"on-ok":t.additionalDataFilterHander},model:{value:t.showAdditionalDataFilterModel,callback:function(e){t.showAdditionalDataFilterModel=e},expression:"showAdditionalDataFilterModel"}},[a("Form",{ref:"filterFormValidate",attrs:{"label-width":100,model:t.filterTemplate,rules:t.filterValidateRule}},[a("FormItem",{attrs:{label:"名称",prop:"showName"}},[a("Input",{model:{value:t.filterTemplate.showName,callback:function(e){t.$set(t.filterTemplate,"showName",e)},expression:"filterTemplate.showName"}})],1),a("FormItem",{attrs:{label:"自定义代码",prop:"name"}},[a("Input",{model:{value:t.filterTemplate.name,callback:function(e){t.$set(t.filterTemplate,"name",e)},expression:"filterTemplate.name"}})],1),a("FormItem",{attrs:{label:"有效期类型",prop:"type"}},[a("Select",{on:{"on-change":t.filterTemplateType},model:{value:t.filterTemplate.type,callback:function(e){t.$set(t.filterTemplate,"type",e)},expression:"filterTemplate.type"}},[a("Option",{attrs:{value:"1"}},[t._v("起始时间 - 终止时间")]),a("Option",{attrs:{value:"2"}},[t._v("某个时间开始 - 长期")]),a("Option",{attrs:{value:"3"}},[t._v("永久")])],1)],1),3!=t.filterTemplate.type?a("FormItem",{attrs:{label:"有效期"}},[1==t.filterTemplate.type?a("DatePicker",{staticStyle:{width:"100%"},attrs:{value:t.filterTemplate.times,type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss",placeholder:"请选择起始时间和终止时间"},on:{"on-change":t.filterTemplateDate}}):t._e(),2==t.filterTemplate.type?a("div",[a("DatePicker",{attrs:{type:"datetime",placeholder:"请选择起始日期",value:t.getDateTime(t.filterTemplate.startTime),format:"yyyy-MM-dd HH:mm:ss"},on:{"on-change":t.filterTemplateDateLongTime}}),t._v("  - 长期")],1):t._e()],1):t._e(),t.filterTemplate.isEdit?t._e():a("FormItem",{attrs:{label:"数据来源"}},[a("Select",{model:{value:t.filterTemplate.dataSourceId,callback:function(e){t.$set(t.filterTemplate,"dataSourceId",e)},expression:"filterTemplate.dataSourceId"}},t._l(t.additionalDataFiliterList,function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),!t.filterTemplate.isEdit&&t.filterTemplate.dataSourceId?a("FormItem",{attrs:{label:"包含数据"}},[a("i-switch",{model:{value:t.filterTemplate.havaData,callback:function(e){t.$set(t.filterTemplate,"havaData",e)},expression:"filterTemplate.havaData"}}),t._v("  如果开启，那么复制的内容就包含数据，否则就只有表头。")],1):t._e(),a("FormItem",{attrs:{label:"备注",prop:"note"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.filterTemplate.note,callback:function(e){t.$set(t.filterTemplate,"note",e)},expression:"filterTemplate.note"}})],1)],1)],1),a("Modal",{attrs:{title:"时间段排序",loading:t.showSortAdditionalDataFilterModelLoading},on:{"on-ok":t.sortAdditionalDataFilterHander},model:{value:t.showSortAdditionalDataFilterModel,callback:function(e){t.showSortAdditionalDataFilterModel=e},expression:"showSortAdditionalDataFilterModel"}},[a("div",{staticClass:"coptions-table"},[a("Row",{staticClass:"coptions-title"},[a("Col",{attrs:{span:"10"}},[t._v("顺序")]),a("Col",{attrs:{span:"14"}},[t._v("时间段")])],1),a("draggable",{attrs:{options:{handle:".index",dragClass:"dragging"}},on:{start:function(e){t.dragging=!0},end:function(e){t.dragging=!1}},model:{value:t.additionalDataFiliterList,callback:function(e){t.additionalDataFiliterList=e},expression:"additionalDataFiliterList"}},t._l(t.additionalDataFiliterList,function(e,i){return a("Row",{key:i,staticClass:"coptions-item",attrs:{gutter:10}},[a("Col",{staticClass:"index",attrs:{span:"10"}},[t._v(t._s(parseInt(i)+1))]),a("Col",{staticClass:"index",attrs:{span:"14"}},[t._v(t._s(e.name))])],1)}))],1)]),a("Modal",{attrs:{title:"列排序",loading:t.showSortColLoading},on:{"on-ok":t.sortColHander},model:{value:t.showSortColModel,callback:function(e){t.showSortColModel=e},expression:"showSortColModel"}},[a("div",{staticClass:"coptions-table"},[a("Row",{staticClass:"coptions-title"},[a("Col",{attrs:{span:"10"}},[t._v("顺序")]),a("Col",{attrs:{span:"14"}},[t._v("时间段")])],1),a("draggable",{attrs:{options:{handle:".index",dragClass:"dragging"}},on:{start:function(e){t.draggingCol=!0},end:function(e){t.draggingCol=!1}},model:{value:t.additionalDataTypes,callback:function(e){t.additionalDataTypes=e},expression:"additionalDataTypes"}},t._l(t.additionalDataTypes,function(e,i){return a("Row",{key:i,staticClass:"coptions-item",attrs:{gutter:10}},[a("Col",{staticClass:"index",attrs:{span:"10"}},[t._v(t._s(parseInt(i)+1))]),a("Col",{staticClass:"index",attrs:{span:"14"}},[t._v(t._s(e.name))])],1)}))],1)]),a("Modal",{attrs:{title:(t.colTemplate.isEdit?"编辑":"添加新")+"列",loading:t.showAdditionalDataTypeModelLoading},on:{"on-ok":t.additionalDataTypeHander},model:{value:t.showAdditionalDataTypeModel,callback:function(e){t.showAdditionalDataTypeModel=e},expression:"showAdditionalDataTypeModel"}},[a("Form",{ref:"colFormValidate",attrs:{"label-width":90,model:t.colTemplate,rules:t.colValidateRule}},[a("FormItem",{attrs:{label:"名称",prop:"showName"}},[a("Input",{model:{value:t.colTemplate.showName,callback:function(e){t.$set(t.colTemplate,"showName",e)},expression:"colTemplate.showName"}})],1),a("FormItem",{attrs:{label:"自定义代码",prop:"name"}},[a("Input",{model:{value:t.colTemplate.name,callback:function(e){t.$set(t.colTemplate,"name",e)},expression:"colTemplate.name"}})],1),a("FormItem",{attrs:{label:"数据类型",prop:"inputType"}},[a("Select",{on:{"on-change":t.colTemplateTypeChange},model:{value:t.colTemplate.inputType,callback:function(e){t.$set(t.colTemplate,"inputType",e)},expression:"colTemplate.inputType"}},[a("Option",{attrs:{value:"text"}},[t._v("文本")]),a("Option",{attrs:{value:"select"}},[t._v("下拉")]),a("Option",{attrs:{value:"checkbox"}},[t._v("多选")]),a("Option",{attrs:{value:"radio"}},[t._v("单选")]),a("Option",{attrs:{value:"datePicker"}},[t._v("日期选择")]),a("Option",{attrs:{value:"dateTimePicker"}},[t._v("日期时间选择")]),a("Option",{attrs:{value:"yearMonthPicker"}},[t._v("年月选择")]),a("Option",{attrs:{value:"yearPicker"}},[t._v("年选择")])],1)],1),"text"===t.colTemplate.inputType?a("FormItem",{attrs:{label:"最大长度",prop:"maxLength"}},[a("Input",{attrs:{placeholder:"留空为不限"},model:{value:t.colTemplate.maxLength,callback:function(e){t.$set(t.colTemplate,"maxLength",e)},expression:"colTemplate.maxLength"}})],1):t._e(),"select"===t.colTemplate.inputType||"radio"===t.colTemplate.inputType||"checkbox"===t.colTemplate.inputType?a("FormItem",{attrs:{label:"数据模板 *（可拖动序号排序）",prop:"maxLength"}},[a("div",{staticClass:"coptions-table"},[a("Row",{staticClass:"coptions-title"},[a("Col",{attrs:{span:"4"}},[t._v("序号")]),a("Col",{attrs:{span:"10"}},[t._v("名称 (留空无效)")]),a("Col",{attrs:{span:"10"}},[t._v("值（留空则和名称相同）")])],1),a("draggable",{attrs:{options:{handle:".index",dragClass:"dragging"}},on:{start:function(e){t.draggingItem=!0},end:function(e){t.draggingItem=!1}},model:{value:t.colTemplate.listItems,callback:function(e){t.$set(t.colTemplate,"listItems",e)},expression:"colTemplate.listItems"}},t._l(t.colTemplate.listItems,function(e,i){return a("Row",{key:i,staticClass:"coptions-item",attrs:{gutter:10}},[a("Col",{staticClass:"index",attrs:{span:"4"}},[t._v(t._s(parseInt(i)+1))]),a("Col",{attrs:{span:"10"}},[a("Input",{model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}})],1),a("Col",{attrs:{span:"10"}},[a("Input",{model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}})],1)],1)}))],1),a("Button",{staticStyle:{float:"right","margin-right":"10px","margin-top":"10px"},on:{click:function(e){t.addListItem(t.colTemplate.listItems)}}},[t._v("增加一行")])],1):t._e(),a("FormItem",{attrs:{label:"备注",prop:"note"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.colTemplate.note,callback:function(e){t.$set(t.colTemplate,"note",e)},expression:"colTemplate.note"}})],1)],1)],1)],1)},s=[],r=a("74c7"),l=r["a"],d=(a("d1c2"),a("2877")),c=Object(d["a"])(l,o,s,!1,null,null,null);c.options.__file="tree-grid.vue";var p=c.exports,m=p,u={name:"data-component-page",components:{TreeGrid:m},data:function(){return{}},mounted:function(){},methods:{}},h=u,g=(a("d81e"),Object(d["a"])(h,i,n,!1,null,"98120d60",null));g.options.__file="DataComponent.vue";e["default"]=g.exports},5996:function(t,e,a){},"71f6":function(t,e,a){},"74c7":function(t,e,a){"use strict";(function(t){a("f751"),a("456d"),a("7514"),a("55dd"),a("6762"),a("2fdb"),a("7f7f"),a("96cf");var i=a("3040"),n=(a("ac6a"),a("f400"),a("aa15")),o=a("413a"),s=a("c276"),r=a("1516"),l=a.n(r);e["a"]={name:"tree-grid",components:{draggable:l.a},data:function(){return{loading:!0,TableAreaHeight:document.body.clientHeight-160,additionalDataFiliterList:[],componentInfo:null,nowEditId:null,columns:[{title:"名称",name:"name",width:400},{title:"Name1",name:"name1"},{title:"Name2",name:"name2"},{title:"Name3",name:"name3"},{title:"备注",name:"remarks"}],columnsTemplate:[{title:"名称",name:"name",width:400},{title:"Name1",name:"name1"},{title:"Name2",name:"name2"},{title:"Name3",name:"name3"},{title:"备注",name:"remarks"}],cantDeleteColumns:["name","name1","name2","name3","remarks"],colTemplate:{id:0,name:"",sort:0,type:1,inputType:"text",dataFilterId:null,otherData:null,maxLength:null,listItems:[{text:"",value:""},{text:"",value:""},{text:"",value:""},{text:"",value:""}],note:"",showName:"",isEdit:!1},filterTemplate:{componentId:0,endTime:"2018-09-10T06:35:17.835Z",id:0,name:"",sort:0,startTime:"2018-09-10T06:35:17.835Z",times:[],type:"1",dataSourceId:null,havaData:!1,note:"",showName:"",isEdit:!1},filterValidateRule:{name:[{required:!0,message:"自定义代码不能为空",trigger:"blur"}],showName:[{required:!0,message:"名称不能为空",trigger:"blur"}],type:[{required:!0,message:"请选择有效期类型",trigger:"change"}]},colValidateRule:{name:[{required:!0,message:"自定义代码不能为空",trigger:"blur"}],showName:[{required:!0,message:"名称不能为空",trigger:"blur"}],inputType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},grid:{},gridData:[],showAdditionalDataFilterModel:!1,showAdditionalDataFilterModelLoading:!0,gridComponent:null,loadingData:!0,listAdditionalData:[],additionalDataTypes:[],additionalDatas:[],showSortAdditionalDataFilterModel:!1,showSortAdditionalDataFilterModelLoading:!0,dragging:!1,showAdditionalDataTypeModel:!1,showAdditionalDataTypeModelLoading:!0,showSortColModel:!1,showSortColLoading:!0,draggingCol:!1,type:new Map([[1e3,"text"],["text",1e3],[1001,"select"],["select",1001],[19e3,"checkbox"],["checkbox",19e3],[1002,"radio"],["radio",1002],[2e3,"datePicker"],["datePicker",2e3],[2005,"dateTimePicker"],["dateTimePicker",2005],["yearMonthPicker",2001],[2001,"yearMonthPicker"],["yearPicker",2002],[2002,"yearPicker"]]),draggingItem:!1}},watch:{nowEditId:function(t,e){console.log("当前正在操作数据的id",t),console.log("当前正在操作数据的id",this.nowEditId),this.tabChange(e)}},mounted:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.dataInit();case 2:this.$nextTick(function(){this.additionalDataFiliterList&&this.additionalDataFiliterList.length&&this.CreateGrid(this.nowEditId,this.gridData,this.additionalDatas),console.log(this.grid),this.loading=!1});case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{addListItem:function(t){t.push({text:"",value:""})},sortColHander:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.showSortColLoading=!0,t.t0=regeneratorRuntime.keys(this.additionalDataTypes);case 2:if((t.t1=t.t0()).done){t.next=11;break}return e=t.t1.value,this.additionalDataTypes[e].sort=e,t.next=7,o["default"].saveAddtionalDataType(this.additionalDataTypes[e]);case 7:a=t.sent,a&&0===a.response.code?this.$Message.success(this.additionalDataTypes[e].name+"的数据设置成功"):a?this.$Message.error(this.additionalDataTypes[e].name+"数据出错："+a.response.msg||this.additionalDataTypes[e].name+"的数据保存失败，请稍后重试"):this.$Message.error(this.additionalDataTypes[e].name+"数据出错：网络错误，请稍后重试"),t.next=2;break;case 11:this.$Message.success("排序设置成功"),this.showSortColModel=!1,this.filterTemplateInit(),this.dataInit(2),this.showSortColLoading=!1;case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleColRemove:function(){var t=this,e=this.grid.getFocusedCell();console.log(e),!e.columnName||this.cantDeleteColumns.includes(e.columnName)?this.$Modal.info({title:"抱歉",content:"<p>当前选择的列不允许删除</p>"}):this.$Modal.confirm({title:"警告",content:"<p>删除后无法恢复，确定删除该列及其数据吗？</p>",onOk:function(){var a=Object(i["a"])(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["default"].removeAdditionalDataType(e.columnName);case 2:i=a.sent,i&&0===i.response.code?(t.$Message.success("删除成功"),t.dataInit(2)):i?t.$Message.error(i.response.msg||"删除失败，请重试"):t.$Message.error("网络错误，请稍后重试");case 4:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}()})},getType:function(t){return this.type.get(t)},getInputType:function(t){return this.type.get(t)},colTemplateTypeChange:function(t){},additionalDataTypeHander:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.showAdditionalDataTypeModelLoading=!0,this.$refs["colFormValidate"].validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(a){var i,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=12;break}return e.colTemplate.componentId=e.$route.query.id,e.additionalDataTypes&&e.additionalDataTypes.length?e.colTemplate.sort=e.additionalDataTypes.length+1:e.colTemplate.sort=1,e.colTemplate.type=e.getType(e.colTemplate.inputType),i={inputType:e.colTemplate.inputType,maxLength:e.colTemplate.maxLength,listItems:e.colTemplate.listItems},e.colTemplate.otherData=JSON.stringify(i),t.next=8,o["default"].saveAddtionalDataType(e.colTemplate);case 8:n=t.sent,n&&0===n.response.code?(e.$Message.success("列设置成功"),e.showAdditionalDataTypeModel=!1,e.colTemplateInit(e.colTemplate.dataFilterId),e.dataInit(2)):n?e.$Message.error(n.response.msg||"保存失败，请检查输入数据是否正确"):e.$Message.error("网络错误，请稍后重试"),t.next=13;break;case 12:e.$Message.error("请检查必填项!");case 13:e.showAdditionalDataTypeModelLoading=!1;case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),sortAdditionalDataFilterHander:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.showAdditionalDataFilterModelLoading=!0,t.t0=regeneratorRuntime.keys(this.additionalDataFiliterList);case 2:if((t.t1=t.t0()).done){t.next=11;break}return e=t.t1.value,this.additionalDataFiliterList[e].sort=e,t.next=7,o["default"].saveAdditionalDataFilter(this.additionalDataFiliterList[e]);case 7:a=t.sent,a&&0===a.response.code?this.$Message.success(this.additionalDataFiliterList[e].name+"的数据设置成功"):a?this.$Message.error(this.additionalDataFiliterList[e].name+"数据出错："+a.response.msg||this.additionalDataFiliterList[e].name+"的数据保存失败，请稍后重试"):this.$Message.error(this.additionalDataFiliterList[e].name+"数据出错：网络错误，请稍后重试"),t.next=2;break;case 11:this.$Message.success("排序设置成功"),this.showSortAdditionalDataFilterModel=!1,this.filterTemplateInit(),this.dataInit(2),this.showAdditionalDataFilterModelLoading=!1;case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getListAdditionalData:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["default"].listAdditionalData(e);case 2:a=t.sent,this.listAdditionalData=a||null,this.additionalDataTypes=a&&a.additionalDataTypes||[],a&&a.additionalDataMap&&a.additionalDataMap.additionalData&&a.additionalDataMap.additionalData.length?this.additionalDatas=a.additionalDataMap.additionalData:this.additionalDatas=[],this.additionalDataTypes.sort(function(t,e){return t.sort-e.sort});case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),dataInit:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,a,i,r=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:1,a=null,1!==e){t.next=22;break}return t.next=5,Promise.all([o["default"].listAdditionalDataFiliter(this.$route.query.id),Object(n["getCompontent"])(this.$route.query.id)]);case 5:if(a=t.sent,a[0].sort(function(t,e){return t.sort-e.sort}),this.additionalDataFiliterList=a[0],this.componentInfo=a[1],i=this.componentInfo.items,this.gridComponent=i.shift(),console.log(this.gridComponent),this.gridData=Object(s["g"])(i,"null","dataUuid","parentUuid","_children"),!this.additionalDataFiliterList||!this.additionalDataFiliterList.length){t.next=19;break}return this.nowEditId=this.additionalDataFiliterList[0].id,t.next=17,this.getListAdditionalData(this.nowEditId);case 17:t.next=20;break;case 19:this.loading=!1;case 20:t.next=32;break;case 22:return t.next=24,Promise.all([o["default"].listAdditionalDataFiliter(this.$route.query.id)]);case 24:if(a=t.sent,this.additionalDataFiliterList=a[0],!this.additionalDataFiliterList||!this.additionalDataFiliterList.length){t.next=31;break}return t.next=29,this.getListAdditionalData(this.nowEditId);case 29:this.nowEditId&&this.findInList()||(this.nowEditId=this.additionalDataFiliterList[0].id),this.CreateGrid(this.nowEditId,this.gridData,this.additionalDatas);case 31:this.loading=!1;case 32:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),findInList:function(){for(var t in this.additionalDataFiliterList)if(this.additionalDataFiliterList[t].id===this.nowEditId)return!0;return!1},getDateTime:function(t){return this.$moment(t).format("YYYY-MM-DD HH:mm:ss")},tabChange:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}return this.loading=!0,t.next=4,this.save(e,!1);case 4:this.dataInit(2);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),save:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e,a){var i,n,s,r,l,d,c,p,m=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.grid||!this.grid.isModified){t.next=14;break}if(i=this.additionalDataFiliterList.find(function(t){return e?t.id===e:t.id===m.nowEditId}),!this.grid.isModified()){t.next=13;break}for(r in a&&this.$Message.info("正在保存中..."),n=this.grid.getModifiedRows().updatedRows,s=[],n){for(c in l={},d=function(t){if("id"===t)l["componentItemId"]=n[r][t];else{var e=m.additionalDataTypes.find(function(e){return e.id===t});e&&(l[t]=n[r][t])}},n[r])d(c);Object.keys(l).length>1&&s.push(l)}return t.next=9,o["default"].saveAdditionalData({additionalData:s,additionalDataFilterId:i.id,componentId:this.$route.query.id});case 9:p=t.sent,p?a?this.$Message.success("保存成功"):this.$Message.success("自动保存“"+i.name+"”的数据成功"):a?this.$Message.error("保存过程中发生了错误，请稍后再试"):this.$Message.error("自动保存“"+i.name+"”数据的过程中发生了错误，请稍后再试"),t.next=14;break;case 13:a&&this.$Message.success("没有检测到被修改的数据");case 14:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}(),filterTemplateType:function(t){2==t&&(this.filterTemplate.endTime="")},filterTemplateDateLongTime:function(t){this.filterTemplate.startTime=t,this.filterTemplate.endTime=""},filterTemplateDate:function(t){console.log(t),this.filterTemplate.startTime=t[0],this.filterTemplate.endTime=t[1]},filterTemplateInit:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$set(this,"filterTemplate",{componentId:0,endTime:"2018-09-10T06:35:17.835Z",id:0,name:"",sort:0,startTime:"2018-09-10T06:35:17.835Z",times:[],type:"1",dataSourceId:null,havaData:!1,note:"",showName:"",isEdit:t})},colTemplateInit:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.$set(this,"colTemplate",{id:0,name:"",sort:0,type:1,inputType:"text",dataFilterId:t,otherData:null,maxLength:null,note:"",showName:"",listItems:[{text:"",value:""},{text:"",value:""},{text:"",value:""},{text:"",value:""}],isEdit:e})},DataHandler:function(t,e){for(var a in t){for(var i in e)e[i].componentItemId===t[a].id&&Object.assign(t[a],e[i]);t[a]._children&&t[a]._children.length&&this.DataHandler(t[a]._children,e)}},getColType:function(t){var e=this.getInputType(t);return"datePicker"===e||"dateTimePicker"===e||"yearMonthPicker"===e||"yearPicker"===e?"text":e},CreateGrid:function(e,a,i){if(t("#grid")){t("#grid").html(""),console.log(a),console.time("数据处理耗时"),a=this.deepCopy(a),this.DataHandler(a,i),console.timeEnd("数据处理耗时");var n=a;for(var o in this.columns=this.deepCopy(this.columnsTemplate),this.additionalDataTypes){var s=JSON.parse(this.additionalDataTypes[o].otherData),r={title:this.additionalDataTypes[o].showName+"("+this.additionalDataTypes[o].name+")",name:this.additionalDataTypes[o].id,editOptions:{type:this.getColType(this.additionalDataTypes[o].type),useViewMode:!0}};if("select"===r["editOptions"]["type"]||"checkbox"===r["editOptions"]["type"]||"radio"===r["editOptions"]["type"])if(s&&s.listItems){for(var l=this.deepCopy(s.listItems),d=l.length-1;d>=0;d--)null===l[d].text||""===l[d].text?l.splice(d,1):null!==l[d].value&&""!==l[d].value||(l[d].value=l[d].text);r["editOptions"]["listItems"]=l}else r["editOptions"]["listItems"]=[];s&&s.maxLength&&"text"===r["editOptions"]["type"]&&(r["editOptions"]["maxLength"]=s.maxLength);var c=this.getInputType(this.additionalDataTypes[o].type);"datePicker"!==c&&"dateTimePicker"!==c&&"yearMonthPicker"!==c&&"yearPicker"!==c||(r.component={name:"datePicker",options:{}},"datePicker"===c?(r.component.options.format="yyyy-MM-dd",r.component.options.date=new Date):"dateTimePicker"===c?(r.component.options.format="yyyy-MM-dd HH:mm:ss",r.component.options.timepicker=!0):"yearMonthPicker"===c?(r.component.options.format="yyyy-MM",r.component.options.type="month"):(r.component.options.format="yyyy",r.component.options.type="year")),console.log(this.additionalDataTypes),console.log(r),this.columns.push(r)}this.grid&&this.grid.destroy&&this.grid.destroy(),this.grid=null,this.grid=new tui.Grid({el:t("#grid"),data:n,rowHeaders:[{type:"rowNum",title:"顺序"}],bodyHeight:this.TableAreaHeight-160,rowHeight:40,virtualScrolling:!0,treeColumnOptions:{name:"name",useCascadingCheckbox:!1},columns:this.columns})}else console.error("元素不存在"),this.$Message.error("发生致命错误，请刷新重试或联系管理员");this.loadingData=!1},addCol:function(t){this.colTemplateInit(t),this.showAdditionalDataTypeModel=!0},editCol:function(){var t=this.grid.getFocusedCell();if(console.log(t),!t.columnName||this.cantDeleteColumns.includes(t.columnName))this.$Modal.info({title:"抱歉",content:"<p>当前选择的列不允许修改</p>"});else{var e=this.additionalDataTypes.find(function(e){return e.id===t.columnName}),a={id:e.id,name:e.name,sort:e.sort,type:e.type,inputType:this.getInputType(e.type),dataFilterId:e.dataFilterId,otherData:e.otherData,note:e.note,showName:e.showName,isEdit:!0},i=JSON.parse(e.otherData);if(i.listItems){a["listItems"]=i.listItems;var n=0;for(var o in a["listItems"])""===a["listItems"][o].text&&n++;while(n>4)for(var s in a["listItems"])if(console.log(a["listItems"][s]),null!==a["listItems"][s]&&""===a["listItems"][s].text){a["listItems"].splice(s,1),--n,console.log("删除一个",n);break}}else a["listItems"]=[{text:"",value:""},{text:"",value:""},{text:"",value:""},{text:"",value:""}];i.maxLength?a["maxLength"]=i.maxLength:a["maxLength"]=null,this.$set(this,"colTemplate",a),this.showAdditionalDataTypeModel=!0}},additionalDataFilterHander:function(){var t=this;this.showAdditionalDataFilterModelLoading=!0,this.$refs["filterFormValidate"].validate(function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(a){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=9;break}return t.filterTemplate.componentId=t.$route.query.id,t.additionalDataFiliterList&&t.additionalDataFiliterList.length?t.filterTemplate.sort=t.additionalDataFiliterList.length+1:t.filterTemplate.sort=1,e.next=5,o["default"].saveAdditionalDataFilter(t.filterTemplate);case 5:i=e.sent,i&&0===i.response.code?(t.$Message.success("时间段设置成功"),t.showAdditionalDataFilterModel=!1,t.filterTemplateInit(),t.dataInit(2)):i?t.$Message.error(i.response.msg||"保存失败，请检查输入数据是否正确"):t.$Message.error("网络错误，请稍后重试"),e.next=10;break;case 9:t.$Message.error("请检查必填项!");case 10:t.showAdditionalDataFilterModelLoading=!1;case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())},handleTabRemove:function(t){var e=this;this.$Modal.confirm({title:"警告",content:"<p>删除后无法恢复，确定删除该时段数据吗？</p>",onOk:function(){var a=Object(i["a"])(regeneratorRuntime.mark(function a(){var i;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["default"].removeAdditionalDataFiliter(t);case 2:i=a.sent,i&&0===i.response.code?(e.$Message.success("删除成功"),e.loading=!0,e.dataInit(2)):i?e.$Message.error(i.response.msg||"删除失败，请重试"):e.$Message.error("网络错误，请稍后重试");case 4:case"end":return a.stop()}},a,this)}));return function(){return a.apply(this,arguments)}}()})},addAdditionalDataFilter:function(){this.filterTemplateInit(),this.showAdditionalDataFilterModel=!0},updateAdditionalDataFilter:function(t){var e=this.additionalDataFiliterList.find(function(e){return e.id===t});this.$set(this,"filterTemplate",{componentId:e.componentId,endTime:e.endTime,id:e.id,name:e.name,sort:e.sort,startTime:e.startTime,times:[this.getDateTime(e.startTime),this.getDateTime(e.endTime)],type:e.type,havaData:!1,dataSourceId:null,note:e.note,showName:e.showName,isEdit:!0}),this.showAdditionalDataFilterModel=!0},sort:function(){this.showSortAdditionalDataFilterModel=!0},sortCol:function(){this.showSortColModel=!0}}}}).call(this,a("1157"))},d1c2:function(t,e,a){"use strict";var i=a("5996"),n=a.n(i);n.a},d81e:function(t,e,a){"use strict";var i=a("71f6"),n=a.n(i);n.a}}]);
//# sourceMappingURL=chunk-3ef95439.73631ec3.js.map