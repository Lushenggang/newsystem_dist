(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f0d9e13"],{"2eb5":function(t,e,s){},"8abc":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"question-page"},[t.pageLoading?s("Spin",{attrs:{size:"large",fix:""}}):t._e(),s("div",{staticClass:"answer-question"},[t.onRecord?t._e():s("div",{staticClass:"question-row"},[s("div",{staticStyle:{height:"480px",width:"100%"}},[s("Card",{staticStyle:{width:"100%",height:"100%"}},[t.onRecord?t._e():s("div",{staticClass:"questionnaire"},[s("div",{staticClass:"project-title"},[t._v(t._s(t.questionnaire.title))]),s("div",{staticClass:"project-description"},[s("span",{staticClass:"description"},[t._v(t._s(t.questionnaire.description))])]),s("div",{staticClass:"bottom-btn"},[s("Button",{attrs:{type:"primary",size:"large"},on:{click:t.start}},[t._v("开始咨询")])],1)])])],1)]),t.onRecord?s("div",{staticClass:"question-row question-center"},[!t.report&&t.schemas?s("div",{staticClass:"que"},[s("div",{staticClass:"backhome"},[s("Button",{staticStyle:{"margin-left":"0.5rem"},attrs:{type:"info"},on:{click:function(e){return e.stopPropagation(),t.reset(e)}}},[t._v("重做")])],1),s("div",{staticClass:"questions"},[s("Card",[s("transition-group",{attrs:{name:"fade"},on:{"after-leave":t.nextQuestion}},t._l(t.schemas,function(e,i){return t.show?s("div",{key:i},[s("h2",{staticClass:"question-title",staticStyle:{"text-align":"center"}},[t._v(t._s(e.title))]),s("p",{staticClass:"question-description"},[t._v(t._s(e.description))]),s("div",{staticClass:"question-options"},[t._l(e.properties,function(i,n){return[i.additional?s("Additional",{key:n,attrs:{title:i.title,additionalKey:n},on:{commit:t.Commit,have:t.AdditionalDown},model:{value:i.additionalShow,callback:function(e){t.$set(i,"additionalShow",e)},expression:"key.additionalShow"}},[t._l(i.properties,function(e,i){return[s("schemaComponent",{key:i,attrs:{name:t.getComponentName(e),schemaType:"big",apiType:"open",propsObject:e,schemaKey:n+"-----"+i},on:{input:t.Input,commit:t.Commit,additional:t.Additional,validator:t.initValidator}})]})],2):"00000000-0000-0000-0000-000000000012"===i.uuid&&i.multiKey?s("MultiNest",{key:n,attrs:{properties:e.properties,answers:t.answers,title:i.title,schemaKey:n,multiKey:i.multiKey},on:{additional:t.Additional}}):s("schemaComponent",{key:n,attrs:{schemaType:"big",apiType:"open",name:t.getComponentName(i),propsObject:i,schemaKey:n},on:{input:t.Input,commit:t.Commit,additional:t.Additional,validator:t.initValidator}})]})],2)]):t._e()})),t.show?s("schemaComponent",{attrs:{schemaType:"big",name:"00000000-0000-0000-0000-0000000000Z1",propsObject:t.button,schemaKey:"button"},on:{commit:t.Commit}}):t._e()],1)],1)]):s("div",{staticClass:"report"},[s("div",{staticClass:"backhome"},[s("Button",{attrs:{type:"info"},on:{click:function(e){e.stopPropagation(),t.reportAnswer(2)}}},[t._v("上一题")]),s("Button",{staticStyle:{"margin-left":"0.5rem"},attrs:{type:"info"},on:{click:function(e){return e.stopPropagation(),t.reset(e)}}},[t._v("重做")])],1),s("transition",{attrs:{name:"fade"}},[s("div",[t.show?s("div",{staticClass:"report-title"},[t._v("报告")]):t._e(),s("div",{staticClass:"report-content",domProps:{innerHTML:t._s(t.reportContent)}})])])],1)]):t._e()])],1)},n=[],r=(s("28a5"),s("ac6a"),s("456d"),s("2fdb"),s("6762"),s("a481"),s("96cf"),s("3040")),o=s("2ac8"),a=s("07b3"),c=s("033f"),l=s("3bec"),u=s("c64e"),h=s.n(u),d=s("52e7"),p={name:"question-page",components:{schemaComponent:l["a"],Additional:a["a"],MultiNest:c["a"],Tree:d["a"]},data:function(){return{pageLoading:!0,schemas:null,schemaBack:null,schemaString:null,compoentMap:null,onRecord:!1,questionnaire:{},answers:{},recordId:null,report:!1,reportContent:null,projectId:"3001",lastPos:{innerWidth:0,innerHeight:0,x:0,y:0},isMove:!1,additionalKeys:[],answerRecord:[],loading:!1,show:!0,validators:{},button:{commit:!0,title:"提交",uuid:"00000000-0000-0000-0000-0000000000Z1"}}},computed:{token:function(){return this.$store.state.user.token}},watch:{loading:function(){this.loading||this.show||(this.show=!0)}},created:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,s=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.projectId=this.$route.query.projectId,this.projectId){t.next=4;break}return this.$Message.error("请重新选择需要访问的项目"),t.abrupt("return");case 4:return this.rootId=this.$route.query.rootId,1==this.$route.query.reset&&(e=h()(),window.localStorage.xAccessToken=e,this.$request.defaults.headers.common["x-access-token"]=e,window.localStorage.setItem("onRecord_"+this.projectId,"0"),window.location.href=window.location.href.replace("&reset=1","")),t.next=8,this.answer(3,"","");case 8:this.$bus.$on("get-root-project",function(t){return t(s.rootId)});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeDestroy:function(){this.$bus.$off("get-root-project")},methods:{answerHandler:function(t,e){var s=["00000000-0000-0000-0000-000000000013","00000000-0000-0000-0000-000000000005","00000000-0000-0000-0000-000000000007"],i=this.deepCopy(t);for(var n in e.properties)if(s.includes(e.properties[n].uuid))for(var r in e.properties[n].properties)!t[n].includes(r)&&e.properties[n].properties[r].additionalKeys&&e.properties[n].properties[r].additionalKeys.length&&(console.log(Object.keys(e.properties[e.properties[n].properties[r].additionalKeys[0]].properties)[0]),delete i[Object.keys(e.properties[e.properties[n].properties[r].additionalKeys[0]].properties)[0]],console.log(i));return JSON.stringify(i)},initValidator:function(t){this.validators[t.key]=t.validator},reset:function(){var t=h()();window.localStorage.xAccessToken=t,this.$request.defaults.headers.common["x-access-token"]=t,window.localStorage.setItem("onRecord_"+this.projectId,"0"),this.answer(3,0,0)},answer:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,s,i,n,r,a,c=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=c.length>0&&void 0!==c[0]?c[0]:3,s=c.length>1?c[1]:void 0,i=c.length>2?c[2]:void 0,n=c.length>3?c[3]:void 0,!this.loading){t.next=6;break}return t.abrupt("return");case 6:return 4===e&&(this.show=!1),this.loading=!0,this.schemaBack=null,null===this.answers.button&&delete this.answers.button,t.next=12,o["default"].answerBig.apply(this,[{projectId:this.projectId,action:e,targetId:n||null,schema:0===s?null:this.schemas,valueJson:0===i?null:"{}"===JSON.stringify(this.answers)?null:this.answerHandler(this.answers,this.schemas)}]);case 12:if(r=t.sent,!r){t.next=47;break}if(1!==r.status){t.next=43;break}if(console.log(r),1!==r.result.schemas[0].uiType){t.next=24;break}window.localStorage.setItem("onRecord_"+this.projectId,"0"),this.questionnaire=r.result.schemas[0],this.report=!1,this.onRecord=!1,this.loading=!1,t.next=41;break;case 24:if(2!==r.result.schemas[0].uiType){t.next=37;break}window.localStorage.setItem("onRecord_"+this.projectId,"4"),a=r.result.schemas,this.additionalKeys=null,this.schemaString=JSON.stringify(a),this.validators={},this.schemas=a,this.answers=this.JsonSchemaParse(this.schemas),this.report=!1,this.onRecord=!0,this.loading=!1,t.next=41;break;case 37:if(3!==r.result.uiType){t.next=41;break}return t.next=40,this.getReport();case 40:this.loading=!1;case 41:t.next=45;break;case 43:this.$Message.error(r.msg||"未知错误"),this.loading=!1;case 45:t.next=49;break;case 47:this.$Message.error("发生错误，请稍后再试"),this.loading=!1;case 49:this.pageLoading=!1;case 50:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getReport:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["default"].getBigReport.apply(this,[{projectId:this.projectId}]);case 2:e=t.sent,console.log(e),1===e.status?(this.reportContent=e.result.remark,this.report=!0,this.onRecord=!0,this.schemaBack=JSON.stringify(this.schema),this.schema=null):this.$Message.error(e.msg);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),reportAnswer:function(t){this.schema=JSON.parse(this.schemaBack),this.answer(t)},typeToValue:function(t){switch(t){case"number":return null;case"string":return"";case"boolean":return!1;case"array":return[];case"object":return{};case"whitespace":return" ";case"null":return null;default:return null}},JsonSchemaParse:function(t){var e=this,s={};return t.map(function(t){for(var i in t.properties)if(t.properties[i].additional)for(var n in t.properties[i].properties)s[n]=e.typeToValue(t.properties[i]["properties"][n]["type"]);else"00000000-0000-0000-0000-000000000012"===t.properties[i].uuid&&t.properties[i].multiKey||(s[i]=e.typeToValue(t.properties[i]["type"]))}),console.log(s),s},start:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.answer(3,0,0);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getComponentName:function(t){return t.uuid},Input:function(t){console.log(t.schemaKey),-1!==t.schemaKey.indexOf("-----")?(this.$set(this.answers,t.schemaKey.split("-----")[1],t.value),this.answers.current=t.schemaKey.split("-----")[1]):(this.$set(this.answers,t.schemaKey,t.value),this.answers.current=t.schemaKey),console.log(t),!0!==t.first&&this.answer(4),console.log(this.answers)},Commit:function(t){var e=this;if(this.validators[t.schemaKey]&&"function"===typeof this.validators[t.schemaKey])this.validators[t.schemaKey]().then(function(){e.commitAnswer(t)},function(){e.$Message.error("请检查必填项！")});else if("button"===t.schemaKey){var s=[];for(var i in this.validators)s.push(this.validators[i]());Promise.all(s).then(function(){e.commitAnswer(t)}).catch(function(t){console.log(t),e.$Message.error("请检查必填项！")})}else this.commitAnswer(t)},commitAnswer:function(t){var e=this;this.$nextTick(function(){e.show=!1}),t.value&&this.$set(this.answers,t.schemaKey,t.value),this.additionalKeys&&this.additionalKeys.length?this.schema.properties[this.additionalKeys[0]].additionalShow=!0:this.answer(5)},Additional:function(t){t.additionalKeys&&t.additionalKeys.length&&(this.additionalKeys=this.deepCopy(t.additionalKeys),t.allowClose?this.schema.properties[this.additionalKeys[0]].additionalShow=!0:this.schema.properties[this.additionalKeys[0]].additionalShow=2)},AdditionalDown:function(t){for(var e in this.additionalKeys)if(this.additionalKeys[e]===t)return this.additionalKeys.splice(e,1),void(this.additionalKeys&&this.additionalKeys.length&&(this.schema.properties[this.additionalKeys[0]].additionalShow=!0))},backTo:function(t){"Report"===t?this.$router.push({name:t,query:{projectId:this.$route.query.projectId,rootId:this.$route.query.rootId}}):"Page"===t?this.$router.push({name:t,params:{projectId:this.$route.query.rootId}}):this.$router.push({name:t,query:{projectId:this.$route.query.rootId}})},nextQuestion:function(){this.loading||(this.show=!0)}}},m=p,f=(s("d178"),s("2877")),y=Object(f["a"])(m,i,n,!1,null,"274c403e",null);y.options.__file="BigQuestion.vue";e["default"]=y.exports},d178:function(t,e,s){"use strict";var i=s("2eb5"),n=s.n(i);n.a}}]);
//# sourceMappingURL=chunk-6f0d9e13.f1baffe9.js.map