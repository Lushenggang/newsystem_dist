(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b572fce"],{"582e":function(e,t,n){"use strict";var s=n("7557"),a=n.n(s);a.a},7557:function(e,t,n){},"7c20":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Form",{ref:"phoneForm",attrs:{model:e.userLoginInfo,rules:e.validators}},[n("FormItem",{attrs:{label:"验证码","label-width":90,prop:"captcha"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入验证码获取随机密码"},model:{value:e.userLoginInfo.captcha,callback:function(t){e.$set(e.userLoginInfo,"captcha",t)},expression:"userLoginInfo.captcha"}})],1),n("Col",{attrs:{span:"8"}},[n("img",{attrs:{src:e.captchaUrl},on:{click:e.refreshCaptcha}})])],1)],1),n("FormItem",{attrs:{label:"手机号码","label-width":90,prop:"phone"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{staticClass:"phone-col",attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入随机密码"},model:{value:e.userLoginInfo.phone,callback:function(t){e.$set(e.userLoginInfo,"phone",t)},expression:"userLoginInfo.phone"}})],1),n("Col",{staticClass:"button-col",attrs:{span:"8"}},[n("Button",{attrs:{type:"primary",loading:e.smsWait},on:{click:e.sendSms}},[e.smsWait?n("span",[e._v(e._s(e.smsWaitTime+"秒后重试"))]):n("span",[e._v("发送短信")])])],1)],1)],1),n("FormItem",{attrs:{label:"短信验证码","label-width":90,prop:"smsCode"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入短信验证码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.handleLogin("phoneForm")}},model:{value:e.userLoginInfo.smsCode,callback:function(t){e.$set(e.userLoginInfo,"smsCode",t)},expression:"userLoginInfo.smsCode"}})],1),n("Col",{attrs:{span:"8"}})],1)],1)],1),n("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleLogin("phoneForm")}}},[e._v("登录")])],1)},a=[],o=(n("a481"),n("96cf"),n("3040")),r=n("7ded"),i=n("b61d"),c=n("29b7"),u={name:"phone-login",data:function(){return{settingInfo:null,userLoginInfo:{captcha:"",smsCode:"",phone:""},loging:!1,validators:{phone:[{required:!0,message:"请输入手机号码",trigger:"change"}],smsCode:[{required:!0,message:"请输入短信验证码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"change"}]},smsWait:!1,smsWaitTime:60,captchaUrl:"",captchaUid:""}},computed:{currentNetworkType:{set:function(e){this.networkType=+e},get:function(){return""+this.networkType}}},created:function(){this.getSettingInfo(),console.log(this.$route)},mounted:function(){this.refreshCaptcha()},watch:{},beforeDestroy:function(){},methods:{getSettingInfo:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(r["getSettingInfo"])();case 3:t=e.sent,this.networkType=t.data.networkType,this.settingInfo=t,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),handleLogin:function(e){var t=this;this.loging=!0,this.$refs[e].validate(function(e){e?t.loginRequest(t.userLoginInfo.phone,t.userLoginInfo.smsCode,1):console.log("表单验证未通过"),t.loging=!1})},loginRequest:function(e,t,n){var s=this,a=new r["LoginParamsModel"](e,t,n);Object(r["requestLogin"])(a).then(function(e){e.response.success?s.$emit("success",new c["a"]({name:"success",event:null,vn:s.$vnode,params:{token:e.data.token,userInfo:e.data.user}})):(s.$Message.error(e.response.msg),s.$emit("failed",new c["a"]({name:"failed",event:null,vn:s.$vnode,params:{token:null,userInfo:null}}))),s.loging=!1}).catch(function(e){console.error(e),s.loging=!1})},sendSms:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,n,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.userLoginInfo.captcha.replace(/\s/g,"")){e.next=3;break}return this.$Message.warning("请输入验证码！"),e.abrupt("return");case 3:if(""!==(""+this.userLoginInfo.phone).replace(/\s/g,"")){e.next=6;break}return this.$Message.warning("请输入手机号码！"),e.abrupt("return");case 6:return e.next=8,Object(i["validateCaptcha"])({captcha:this.userLoginInfo.captcha,uuid:this.captchaUid});case 8:if(t=e.sent,t.response.success){e.next=12;break}return this.$Message.error("验证码错误，请重新输入！"),e.abrupt("return");case 12:this.smsWait=!0,this.smsWaitTime=60,n=setInterval(function(){s.smsWaitTime<=1&&(clearInterval(n),s.smsWait=!1),s.smsWaitTime=s.smsWaitTime-1},1e3),Object(i["sendSmsCode"])({phone:this.userLoginInfo.phone,type:2,captcha:this.userLoginInfo.captcha,captchaUuid:this.captchaUid}).then(function(e){e.response.success?s.$Message.success("短信发送成功！"):s.$Message.error(e.response.msg)});case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),refreshCaptcha:function(){var e=this;Object(i["getCaptcha"])().then(function(t){e.captchaUrl="data:image;base64,".concat(t.data.image),e.captchaUid=t.data.uuid})}}},p=u,l=(n("e8f5"),n("2877")),h=Object(l["a"])(p,s,a,!1,null,null,null);h.options.__file="phone-login.vue";var f=h.exports;t["a"]=f},"7e8d":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Layout",{staticClass:"bind-phone-page"},[n("Row",{staticClass:"bind-phone-header"},[n("h1",[e._v("绑定电话号码继续使用")])]),n("phoneLogin",{on:{success:e.handleLoginSuccess,failed:e.handleLoginFailed}})],1)},a=[],o=(n("a481"),n("cadf"),n("551c"),n("097d"),n("7c20")),r=n("7e70"),i={name:"bind-phone",components:{phoneLogin:o["a"]},methods:{handleLoginSuccess:function(e){var t=this,n=this.deepCopy(this.$store.getters["user/userInfo"]);e.params.userInfo.unionid=n.unionid,this.$store.commit("user/setToken",e.params.token),this.$store.commit("user/setUserInfo",e.params.userInfo),Object(r["bindWx"])({id:e.params.userInfo.id,unionid:e.params.userInfo.unionid}).then(function(e){e.response.success?t.$router.replace({name:"Home"}):(t.$Message.error(e.response.msg),t.$router.replace({name:"Login"}))}).catch(function(e){console.error(e)})},handleLoginFailed:function(e){console.error(e)}}},c=i,u=(n("582e"),n("2877")),p=Object(u["a"])(c,s,a,!1,null,"5263b7d6",null);p.options.__file="BindPhone.vue";t["default"]=p.exports},"8ecb":function(e,t,n){},e8f5:function(e,t,n){"use strict";var s=n("8ecb"),a=n.n(s);a.a}}]);
//# sourceMappingURL=chunk-3b572fce.1221337e.js.map