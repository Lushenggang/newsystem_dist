(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-185f6e20"],{"013f":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.settingInfo?n("Layout",{staticClass:"login-page"},[n("Row",{staticClass:"login-header"},[n("Row",[n("h1",{staticClass:"login-title"},[e._v("登录")])])],1),2===e.networkType&&"phone"===e.currentLoginType?[n("Row",{staticClass:"login-form"},[n("Row",{staticClass:"form-body"},[n("phoneLogin",{on:{success:e.loginSuccess,failed:e.loginFailed}})],1),n("div",{staticClass:"login-footer"},[n("a",{attrs:{href:"javascript: void(0)"},on:{click:function(t){e.currentLoginType="wx"}}},[e._v("使用微信登录")])])],1)]:e._e(),2===e.networkType&&"wx"===e.currentLoginType?[n("div",{staticClass:"login-form"},[n("weixinLogin",{attrs:{type:"login"},on:{success:e.wxLoginSuccess}},[n("div",{staticClass:"login-footer"},[n("a",{attrs:{href:"javascript: void(0)"},on:{click:function(t){e.currentLoginType="phone"}}},[e._v("使用手机登录")])])])],1)]:e._e(),1===e.networkType?[n("div",{staticClass:"login-form"},[n("accountLogin",{on:{success:e.loginSuccess,failed:e.loginFailed}})],1)]:e._e()],2):e._e()},o=[],r=(n("a481"),n("96cf"),n("3040")),a=n("7ded"),i=n("7e70"),c=n("7c20"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Row",{staticClass:"form-body"},[n("Form",{ref:"accountForm",attrs:{model:e.userLoginInfo,rules:e.validators}},[n("FormItem",{attrs:{label:"账号","label-width":80,prop:"username"}},[n("Input",{attrs:{type:"text",placeholder:"请输入账号"},model:{value:e.userLoginInfo.username,callback:function(t){e.$set(e.userLoginInfo,"username",t)},expression:"userLoginInfo.username"}})],1),n("FormItem",{attrs:{label:"密码","label-width":80,prop:"password"}},[n("Input",{attrs:{type:"password",placeholder:"请输入密码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.handleLogin("accountForm")}},model:{value:e.userLoginInfo.password,callback:function(t){e.$set(e.userLoginInfo,"password",t)},expression:"userLoginInfo.password"}})],1)],1)],1),n("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleLogin("accountForm")}}},[e._v("登录")])],1)},l=[],g=n("29b7"),p={name:"account-login",data:function(){return{settingInfo:null,userLoginInfo:{username:"zhangsan1",password:"123456"},loging:!1,validators:{username:[{required:!0,message:"请输入账号",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"change"}]}}},methods:{handleLogin:function(e){var t=this;this.loging=!0,this.$refs[e].validate(function(e){e?t.loginRequest(t.userLoginInfo.username,t.userLoginInfo.password,2):console.log("表单验证未通过"),t.loging=!1})},loginRequest:function(e,t,n){var s=this,o=new a["LoginParamsModel"](e,t,n);Object(a["requestLogin"])(o).then(function(e){e.response.success?s.$emit("success",new g["a"]({name:"success",event:null,vn:s.$vnode,params:{token:e.data.token,userInfo:e.data.user}})):(s.$Message.error(e.response.msg),s.$emit("failed",new g["a"]({name:"failed",event:null,vn:s.$vnode,params:{token:null,userInfo:null}}))),s.loging=!1}).catch(function(e){console.error(e),s.loging=!1})}}},f=p,h=n("2877"),d=Object(h["a"])(f,u,l,!1,null,null,null);d.options.__file="account-login.vue";var m=d.exports,v=m,w=n("76bc"),I={name:"login-page",components:{phoneLogin:c["a"],accountLogin:v,weixinLogin:w["a"]},data:function(){return{settingInfo:null,networkType:1,currentLoginType:"wx"}},computed:{currentNetworkType:{set:function(e){this.networkType=+e},get:function(){return""+this.networkType}}},created:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getSettingInfo();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{wxLoginSuccess:function(e){var t=this;Object(i["wxLogin"])({code:e}).then(function(e){e.response.success?t.bindSuccess(e.data.token,e.data.user):(console.error("微信登录失败"),t.bindFailed(e.response.msg))}).catch(function(e){console.error(e),t.loginFailed(e)})},bindSuccess:function(e,t){this.$store.commit("user/setToken",e),this.$store.commit("user/setUserInfo",t),this.$router.replace({name:"Home"})},bindFailed:function(e){this.$Message.error(e)},getSettingInfo:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(a["getSettingInfo"])();case 3:t=e.sent,this.networkType=t.data.networkType,this.settingInfo=t,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),loginSuccess:function(e){this.$store.commit("user/setToken",e.params.token),this.$store.commit("user/setUserInfo",e.params.userInfo),this.$Message.success("登录成功！"),this.$router.push({name:"Home"})},loginFailed:function(e){this.$Message.error("登录失败！"),console.log(e)}}},b=I,L=(n("dc29"),Object(h["a"])(b,s,o,!1,null,"3e91cb96",null));L.options.__file="Login.vue";t["default"]=L.exports},"1fc6":function(e,t,n){},"76bc":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Layout",[n("div",{attrs:{id:"qrcode"}},[n("h2",[e._v(e._s(e.title))]),n("img",{attrs:{src:e.qrCode}}),n("div",{staticClass:"show-msg"},[e._v(e._s(e.wxLoginMsg))])])])},o=[],r=n("7ded"),a={name:"weixin-login",props:{type:{type:String,required:!1,default:"login"},title:String},data:function(){return{wxUUID:"",qrCode:"",wxLoginMsg:"请用微信扫描二维码登录"}},created:function(){this.getQRCode()},methods:{getQRCode:function(){var e=this;Object(r["getQRCode"])().then(function(t){t.status;var n=t.result;e.wxUUID=n.wxUUID,e.qrCode=n.imgData,e.getWxCode(e.wxUUID)})},getWxCode:function(){var e=this;Object(r["getWxCode"])({uuid:this.wxUUID}).then(function(t){var n=t.result,s=t.status,o=t.msg;if(s&&405===s)e.wxLoginMsg=o,e.$emit("success",n.code);else if(500===s)e.getQRCode();else{s&&404===s&&(e.wxLoginMsg=o.title+", "+o.content);var r=setTimeout(function(){e.getWxCode(),clearTimeout(r)},2e3);console.log(n)}}).catch(function(t){var n=setTimeout(function(){e.getWxCode(),clearTimeout(n)},2e3);console.error(t)})}}},i=a,c=n("2877"),u=Object(c["a"])(i,s,o,!1,null,null,null);u.options.__file="weixin-login.vue";var l=u.exports;t["a"]=l},"7c20":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Form",{ref:"phoneForm",attrs:{model:e.userLoginInfo,rules:e.validators}},[n("FormItem",{attrs:{label:"验证码","label-width":90,prop:"captcha"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入验证码获取随机密码"},model:{value:e.userLoginInfo.captcha,callback:function(t){e.$set(e.userLoginInfo,"captcha",t)},expression:"userLoginInfo.captcha"}})],1),n("Col",{attrs:{span:"8"}},[n("img",{attrs:{src:e.captchaUrl},on:{click:e.refreshCaptcha}})])],1)],1),n("FormItem",{attrs:{label:"手机号码","label-width":90,prop:"phone"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{staticClass:"phone-col",attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入随机密码"},model:{value:e.userLoginInfo.phone,callback:function(t){e.$set(e.userLoginInfo,"phone",t)},expression:"userLoginInfo.phone"}})],1),n("Col",{staticClass:"button-col",attrs:{span:"8"}},[n("Button",{attrs:{type:"primary",loading:e.smsWait},on:{click:e.sendSms}},[e.smsWait?n("span",[e._v(e._s(e.smsWaitTime+"秒后重试"))]):n("span",[e._v("发送短信")])])],1)],1)],1),n("FormItem",{attrs:{label:"短信验证码","label-width":90,prop:"smsCode"}},[n("Row",{attrs:{type:"flex",gutter:16}},[n("Col",{attrs:{span:"16"}},[n("Input",{attrs:{type:"text",placeholder:"请输入短信验证码"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.handleLogin("phoneForm")}},model:{value:e.userLoginInfo.smsCode,callback:function(t){e.$set(e.userLoginInfo,"smsCode",t)},expression:"userLoginInfo.smsCode"}})],1),n("Col",{attrs:{span:"8"}})],1)],1)],1),n("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleLogin("phoneForm")}}},[e._v("登录")])],1)},o=[],r=(n("a481"),n("96cf"),n("3040")),a=n("7ded"),i=n("b61d"),c=n("29b7"),u={name:"phone-login",data:function(){return{settingInfo:null,userLoginInfo:{captcha:"",smsCode:"",phone:""},loging:!1,validators:{phone:[{required:!0,message:"请输入手机号码",trigger:"change"}],smsCode:[{required:!0,message:"请输入短信验证码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"change"}]},smsWait:!1,smsWaitTime:60,captchaUrl:"",captchaUid:""}},computed:{currentNetworkType:{set:function(e){this.networkType=+e},get:function(){return""+this.networkType}}},created:function(){this.getSettingInfo(),console.log(this.$route)},mounted:function(){this.refreshCaptcha()},watch:{},beforeDestroy:function(){},methods:{getSettingInfo:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(a["getSettingInfo"])();case 3:t=e.sent,this.networkType=t.data.networkType,this.settingInfo=t,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),handleLogin:function(e){var t=this;this.loging=!0,this.$refs[e].validate(function(e){e?t.loginRequest(t.userLoginInfo.phone,t.userLoginInfo.smsCode,1):console.log("表单验证未通过"),t.loging=!1})},loginRequest:function(e,t,n){var s=this,o=new a["LoginParamsModel"](e,t,n);Object(a["requestLogin"])(o).then(function(e){e.response.success?s.$emit("success",new c["a"]({name:"success",event:null,vn:s.$vnode,params:{token:e.data.token,userInfo:e.data.user}})):(s.$Message.error(e.response.msg),s.$emit("failed",new c["a"]({name:"failed",event:null,vn:s.$vnode,params:{token:null,userInfo:null}}))),s.loging=!1}).catch(function(e){console.error(e),s.loging=!1})},sendSms:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.userLoginInfo.captcha.replace(/\s/g,"")){e.next=3;break}return this.$Message.warning("请输入验证码！"),e.abrupt("return");case 3:if(""!==(""+this.userLoginInfo.phone).replace(/\s/g,"")){e.next=6;break}return this.$Message.warning("请输入手机号码！"),e.abrupt("return");case 6:return e.next=8,Object(i["validateCaptcha"])({captcha:this.userLoginInfo.captcha,uuid:this.captchaUid});case 8:if(t=e.sent,t.response.success){e.next=12;break}return this.$Message.error("验证码错误，请重新输入！"),e.abrupt("return");case 12:this.smsWait=!0,this.smsWaitTime=60,n=setInterval(function(){s.smsWaitTime<=1&&(clearInterval(n),s.smsWait=!1),s.smsWaitTime=s.smsWaitTime-1},1e3),Object(i["sendSmsCode"])({phone:this.userLoginInfo.phone,type:2,captcha:this.userLoginInfo.captcha,captchaUuid:this.captchaUid}).then(function(e){e.response.success?s.$Message.success("短信发送成功！"):s.$Message.error(e.response.msg)});case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),refreshCaptcha:function(){var e=this;Object(i["getCaptcha"])().then(function(t){e.captchaUrl="data:image;base64,".concat(t.data.image),e.captchaUid=t.data.uuid})}}},l=u,g=(n("e8f5"),n("2877")),p=Object(g["a"])(l,s,o,!1,null,null,null);p.options.__file="phone-login.vue";var f=p.exports;t["a"]=f},"8ecb":function(e,t,n){},dc29:function(e,t,n){"use strict";var s=n("1fc6"),o=n.n(s);o.a},e8f5:function(e,t,n){"use strict";var s=n("8ecb"),o=n.n(s);o.a}}]);
//# sourceMappingURL=chunk-185f6e20.c6bd8e5a.js.map