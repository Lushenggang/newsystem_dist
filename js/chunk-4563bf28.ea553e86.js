(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4563bf28"],{1765:function(e,t,s){},"34ee":function(e,t,s){"use strict";var i=s("1765"),o=s.n(i);o.a},"3de65":function(e,t,s){"use strict";var i=s("962a"),o=s.n(i);o.a},"90b2":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"question-page"},[e.pageLoading?s("Spin",{attrs:{size:"large",fix:""}}):e._e(),s("div",{ref:"nodeTree",staticClass:"question-node-tree",class:{moving:e.isMove}},[s("div",{staticClass:"tree-title"},[e._v("节点列表")]),s("div",{staticClass:"tree-body"},[s("nodeEditor",{attrs:{projectId:e.projectId,editable:!0,focusNode:e.schema?e.schema.nodeId:-1,expandAll:!1},on:{"current-focus":e.jumpTo}})],1)]),s("devide"),s("div",{staticClass:"answer-question"},[e.onRecord?e._e():s("div",{staticClass:"question-row"},[s("div",[s("Card",[e.onRecord?e._e():s("div",{staticClass:"questionnaire"},[s("div",{staticClass:"project-title"},[e._v(e._s(e.questionnaire.title))]),s("div",{staticClass:"project-description"},[s("span",{staticClass:"description"},[e._v(e._s(e.questionnaire.description))])]),s("div",{staticClass:"bottom-btn"},[s("Button",{attrs:{type:"primary",size:"large"},on:{click:e.start}},[e._v("开始咨询")])],1)])])],1),s("div",{staticClass:"backhome"},[s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Home")}}},[e._v("返回主页")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Page")}}},[e._v("返回项目页")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Report")}}},[e._v("返回报告页")])],1)]),e.onRecord?s("div",{staticClass:"question-row question-center"},[!e.report&&this.schema?s("div",{staticClass:"que"},[s("div",{staticClass:"questions"},[s("Card",[s("div",{staticClass:"question-title"},[s("div",{staticClass:"title"},[e._v(e._s(e.schema.title))]),e.schema.description?s("div",{staticClass:"description"},[e._v("("+e._s(e.schema.description)+")")]):e._e()]),e._l(e.schema.properties,function(t,i){return[t.additional?s("Additional",{key:i,attrs:{title:t.title,additionalKey:i},on:{commit:e.Commit,have:e.AdditionalDown},model:{value:t.additionalShow,callback:function(s){e.$set(t,"additionalShow",s)},expression:"key.additionalShow"}},[e._l(t.properties,function(t,o){return[s("schemaComponent",{key:o,attrs:{name:e.getComponentName(t),propsObject:t,schemaKey:i+"-----"+o},on:{input:e.Input,commit:e.Commit,additional:e.Additional}})]})],2):"00000000-0000-0000-0000-000000000012"===t.uuid&&t.multiKey?s("MultiNest",{key:i,attrs:{properties:e.schema.properties,answers:e.answers,title:t.title,schemaKey:i,multiKey:t.multiKey},on:{additional:e.Additional}}):s("schemaComponent",{key:i,staticClass:"answer-area",attrs:{name:e.getComponentName(t),propsObject:t,schemaKey:i},on:{input:e.Input,commit:e.Commit,additional:e.Additional}})]})],2)],1),s("div",{staticClass:"backhome"},[s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.answer(2)}}},[e._v("上一题")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){return t.stopPropagation(),e.reset(t)}}},[e._v("重做")])],1)]):s("div",{staticClass:"report"},[s("div",{staticClass:"report-title"},[e._v("律品法律咨询意见书")]),s("div",{staticClass:"report-content",domProps:{innerHTML:e._s(e.reportContent?e.reportContent:"咨询报告为空")}}),s("div",{staticClass:"backhome"},[s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Home")}}},[e._v("返回主页")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Page")}}},[e._v("返回项目页")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.backTo("Report")}}},[e._v("返回报告页")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){t.stopPropagation(),e.reportAnswer(2)}}},[e._v("上一题")]),s("Button",{staticClass:"back-button",attrs:{type:"info"},on:{click:function(t){return t.stopPropagation(),e.reset(t)}}},[e._v("重做")])],1)])]):e._e()]),s("devide"),s("div",{staticClass:"answer-record"},[s("div",{staticClass:"answer-record-title"},[e._v("做题记录")]),s("Tree",{staticClass:"answer-record-tree",attrs:{treeData:e.answerRecord,nodeClass:"tree-node-container",expand:!1},on:{"node-double-click":e.handleRecordClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data,o=t.parentData;return s("div",{staticClass:"node-render-content",class:{"root-node-content":o.isRoot},attrs:{title:"双击可以重做该题"}},[o.isRoot?s("span",{staticClass:"root-node-title"},[e._v(e._s(o.children.findIndex(function(e){return e.id===i.id})+1+". "))]):e._e(),e._v(e._s(i.title))])}}])})],1)],1)},o=[],r=(s("28a5"),s("ac6a"),s("456d"),s("2fdb"),s("6762"),s("96cf"),s("3040")),n=s("2ac8"),a=s("07b3"),d=s("033f"),c=s("3bec"),u=s("d83b"),h=s("c64e"),l=s.n(h),p=s("52e7"),f=s("339e"),v=s.n(f),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"devide",staticClass:"devide"})},g=[],y=(s("ac4d"),s("8a81"),s("c5f6"),{props:{vertical:{type:Boolean,default:!1},size:{type:Number,default:5}},data:function(){return{before:null,after:null,oldPos:{}}},mounted:function(){this.getBrother()},beforeDestroy:function(){this.before&&(this.before.removeEventListener("mousemove",this.elementMouseMove),this.before=null),this.after&&(this.after.removeEventListener("mousemove",this.elementMouseMove),this.after=null)},methods:{getBrother:function(){if(this.$refs.devide){var e=this.before,t=this.after;this.after=this.$refs.devide.nextSibling;var s=this.$refs.devide.parentElement,i=s.childNodes,o=!0,r=!1,n=void 0;try{for(var a,d=i[Symbol.iterator]();!(o=(a=d.next()).done);o=!0){var c=a.value;if(c.nextSibling===this.$refs.devide){this.before=c;break}}}catch(e){r=!0,n=e}finally{try{o||null==d.return||d.return()}finally{if(r)throw n}}return e&&e!==this.before&&e.removeEventListener("mousemove",this.elementMouseMove),t&&t!==this.after&&t.removeEventListener("mousemove",this.elementMouseMove),!(!this.before||!this.after)&&(this.before!==e&&this.before.addEventListener("mousemove",this.elementMouseMove),this.after!==t&&this.after.addEventListener("mousemove",this.elementMouseMove),!0)}},inArea:function(e){if(!this.getBrother())return!1;var t=this.before.getBoundingClientRect(),s=this.after.getBoundingClientRect(),i=!0;return this.vertical?(i=e.clientX<=t.right&&e.clientX<=s.right,i=i&&e.clientX>=t.left&&e.clientY>=s.left,i=i&&e.clientY>=t.bottom-this.size&&e.clientY<=s.top+this.size):(i=e.clientY<=t.bottom&&e.clientY<=s.bottom,i=i&&e.clientY>=t.top&&e.clientY>=s.top,i=i&&e.clientX>=t.right-this.size&&e.clientX<=s.left+this.size),i},elementMouseMove:function(e){if(!this.inArea(e))return this.before&&(this.before.removeEventListener("mousedown",this.mouseDown),this.before.__devide&&this.before.__devide===this.$refs.devide&&(this.before.classList.remove("__devide-move-s","__devide-move-e"),delete this.before.__devide)),void(this.after&&(this.after.removeEventListener("mousedown",this.mouseDown),this.after.__devide&&this.after.__devide===this.$refs.devide&&(this.after.classList.remove("__devide-move-s","__devide-move-e"),delete this.after.__devide)));this.before.__devide=this.$refs.devide,this.after.__devide=this.$refs.devide;var t=this.vertical?"__devide-move-s":"__devide-move-e";this.after.classList.add(t),this.before.classList.add(t),this.before.addEventListener("mousedown",this.mouseDown),this.after.addEventListener("mousedown",this.mouseDown)},mouseDown:function(e){if(this.getBrother()){var t=this.before.getBoundingClientRect(),s=this.after.getBoundingClientRect();this.oldPos={x:e.clientX,y:e.clientY,beforeWidth:t.width,beforeHeight:t.height,afterWidth:s.width,afterHeight:s.height},document.addEventListener("mousemove",this.mouseMove),document.addEventListener("mouseup",this.mouseUp),document.addEventListener("mouseleave",this.mouseLeave)}},mouseMove:function(e){if(this.getBrother())if(this.vertical){var t=e.clientY-this.oldPos.y;t=t>=0?Math.min(this.oldPos.afterHeight,t):-Math.min(this.oldPos.beforeHeight,-t);var s=this.oldPos.beforeHeight+t,i=this.oldPos.afterHeight+this.oldPos.beforeHeight-s,o=getComputedStyle(this.before).getPropertyValue("height"),r=getComputedStyle(this.after).getPropertyValue("height");this.before.style.height=s+"px",this.after.style.height=i+"px",getComputedStyle(this.before).getPropertyValue("height")!==o&&getComputedStyle(this.after).getPropertyValue("height")!==r||(this.before.style.width=o,this.after.style.width=r)}else{var n=e.clientX-this.oldPos.x;n=n>=0?Math.min(this.oldPos.afterWidth,n):-Math.min(this.oldPos.beforeWidth,-n);var a=this.oldPos.beforeWidth+n,d=this.oldPos.afterWidth+this.oldPos.beforeWidth-a,c=getComputedStyle(this.before).getPropertyValue("width"),u=getComputedStyle(this.after).getPropertyValue("width");this.before.style.width=a+"px",this.after.style.width=d+"px",getComputedStyle(this.before).getPropertyValue("width")!==c&&getComputedStyle(this.after).getPropertyValue("width")!==u||(this.before.style.width=c,this.after.style.width=u)}},mouseUp:function(e){this.clearEvent()},mouseLeave:function(e){this.clearEvent()},clearEvent:function(){this.before&&this.before.removeEventListener("mousedown",this.mouseDown),this.after&&this.after.removeEventListener("mousedown",this.mouseDown),document.removeEventListener("mouseup",this.mouseUp),document.removeEventListener("mouseleave",this.mouseLeave),document.removeEventListener("mousemove",this.mouseMove)}}}),b=y,w=(s("34ee"),s("2877")),k=Object(w["a"])(b,m,g,!1,null,null,null);k.options.__file="devide.vue";var C=k.exports,_=C,x={name:"question-page",components:{schemaComponent:c["a"],nodeEditor:u["a"],Additional:a["a"],MultiNest:d["a"],Tree:p["a"],devide:_},data:function(){return{pageLoading:!0,schema:null,schemaBack:null,schemaString:null,compoentMap:null,onRecord:!1,questionnaire:{},answers:{},recordId:null,report:!1,reportContent:null,projectId:"3001",lastPos:{innerWidth:0,innerHeight:0,x:0,y:0},isMove:!1,additionalKeys:[],answerRecord:[],loading:!1,converter:null}},computed:{token:function(){return this.$store.state.user.token}},created:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.converter||(this.converter=new v.a.Converter({literalMidWordUnderscores:!0})),this.projectId=this.$route.query.projectId||"1",this.rootId=this.$route.query.rootId,1==this.$route.query.reset?(t=l()(),this.updateQuery("xAccessToken",t),this.$request.defaults.headers.common["x-access-token"]=t,this.updateQuery("onRecord","0"),this.updateQuery("reset")):this.$request.defaults.headers.common["x-access-token"]=this.$route.query.xAccessToken,"3"!==this.$route.query.onRecord){e.next=10;break}return e.next=7,this.getReport();case 7:this.requestAnswerRecord(),e.next=17;break;case 10:if("1"!==this.$route.query.onRecord){e.next=15;break}return e.next=13,this.answer(1);case 13:e.next=17;break;case 15:return e.next=17,this.answer(null,"","");case 17:this.$bus.$on("get-root-project",function(e){return e(s.rootId)});case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),beforeDestroy:function(){this.$bus.$off("get-root-project")},methods:{updateQuery:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null===t?delete this.$route.query[e]:this.$route.query[e]=t,s?window.history.replaceState(null,null,window.location.origin+window.location.hash.substring(0,window.location.hash.indexOf("?"))+"?"+this.$qs.stringify(this.$route.query)):window.history.pushState(null,null,window.location.origin+window.location.hash.substring(0,window.location.hash.indexOf("?"))+"?"+this.$qs.stringify(this.$route.query))},jumpTo:function(e){var t=this;console.log("jump",e),this.$nextTick(function(){t.searchNodeEl=document.querySelector("#node-title-".concat(e.params.node.uuid));var s=document.querySelector("#node-".concat(e.params.node.id)),i=t.$refs.nodeTree;if(s){var o=s.getBoundingClientRect().top-i.getBoundingClientRect().top;o>i.scrollTop&&i.scrollTo({top:o,behavior:"smooth"})}})},answerHandler:function(e,t){var s=["00000000-0000-0000-0000-000000000013","00000000-0000-0000-0000-000000000005","00000000-0000-0000-0000-000000000007"],i=this.deepCopy(e);for(var o in t.properties)if(s.includes(t.properties[o].uuid))for(var r in t.properties[o].properties)!e[o].includes(r)&&t.properties[o].properties[r].additionalKeys&&t.properties[o].properties[r].additionalKeys.length&&(console.log(Object.keys(t.properties[t.properties[o].properties[r].additionalKeys[0]].properties)[0]),delete i[Object.keys(t.properties[t.properties[o].properties[r].additionalKeys[0]].properties)[0]],console.log(i));return JSON.stringify(i)},reset:function(){var e=l()();this.updateQuery("xAccessToken",e),this.$request.defaults.headers.common["x-access-token"]=e,this.updateQuery("onRecord","0"),this.answer(null,0,0)},answer:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,s,i,o,r,a,d=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:1,s=d.length>1?d[1]:void 0,i=d.length>2?d[2]:void 0,o=d.length>3?d[3]:void 0,!this.loading){e.next=6;break}return e.abrupt("return");case 6:return this.loading=!0,this.schemaBack=null,null===this.answers.button&&delete this.answers.button,e.next=11,n["default"].answer.apply(this,[{projectId:this.projectId,action:t,targetId:o||null,schema:0===s?null:2===t?null:this.schema,valueJson:0===i?null:2===t||"{}"===JSON.stringify(this.answers)?null:this.answerHandler(this.answers,this.schema)}]);case 11:if(r=e.sent,!r){e.next=48;break}if(1!==r.status){e.next=43;break}if(console.log(r),1!==r.result.uiType){e.next=23;break}this.updateQuery("onRecord","0"),this.questionnaire=r.result.schema,this.report=!1,this.onRecord=!1,this.loading=!1,e.next=41;break;case 23:if(2!==r.result.uiType){e.next=35;break}this.updateQuery("onRecord","1"),a=r.result.schema,this.additionalKeys=null,this.schemaString=JSON.stringify(a),this.schema=a,this.answers=this.JsonSchemaParse(this.schema),this.report=!1,null===a.properties?this.onRecord=!1:this.onRecord=!0,this.loading=!1,e.next=41;break;case 35:if(3!==r.result.uiType){e.next=41;break}return this.updateQuery("onRecord","1"),console.log(r),e.next=40,this.getReport();case 40:this.loading=!1;case 41:e.next=45;break;case 43:this.$Message.error(r.msg||"未知错误"),this.loading=!1;case 45:this.requestAnswerRecord(),e.next=50;break;case 48:this.$Message.error("发生错误，请稍后再试"),this.loading=!1;case 50:this.pageLoading=!1;case 51:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getReport:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n["default"].getReport.apply(this,[{projectId:this.projectId}]);case 2:t=e.sent,1===t.status?(console.log(t),this.reportContent=this.converter.makeHtml(t.result.remark),this.report=!0,this.onRecord=!0,this.schemaBack=JSON.stringify(this.schema),this.schema=null,this.updateQuery("onRecord","3")):this.$Message.error(t.msg),this.pageLoading=!1;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),reportAnswer:function(e){this.schema=JSON.parse(this.schemaBack),this.answer(e)},typeToValue:function(e){switch(e){case"number":return null;case"string":return"";case"boolean":return!1;case"array":return[];case"object":return{};case"whitespace":return" ";case"null":return null;default:return null}},JsonSchemaParse:function(e){var t={};for(var s in e.properties)if(e.properties[s].additional)for(var i in e.properties[s].properties)t[i]=this.typeToValue(e.properties[s]["properties"][i]["type"]);else"00000000-0000-0000-0000-000000000012"===e.properties[s].uuid&&e.properties[s].multiKey||(t[s]=this.typeToValue(e.properties[s]["type"]));return console.log(t),t},start:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.answer(1,0,0);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getComponentName:function(e){return e.uuid},Input:function(e){console.log(e.schemaKey),-1!==e.schemaKey.indexOf("-----")?this.$set(this.answers,e.schemaKey.split("-----")[1],e.value):this.$set(this.answers,e.schemaKey,e.value),console.log(this.answers)},Commit:function(e){e.value&&this.$set(this.answers,e.schemaKey,e.value),this.additionalKeys&&this.additionalKeys.length?this.schema.properties[this.additionalKeys[0]].additionalShow=!0:this.answer()},Additional:function(e){e.additionalKeys&&e.additionalKeys.length&&(this.additionalKeys=this.deepCopy(e.additionalKeys),e.allowClose?this.schema.properties[this.additionalKeys[0]].additionalShow=!0:this.schema.properties[this.additionalKeys[0]].additionalShow=2)},AdditionalDown:function(e){for(var t in this.additionalKeys)if(this.additionalKeys[t]===e)return this.additionalKeys.splice(t,1),void(this.additionalKeys&&this.additionalKeys.length&&(this.schema.properties[this.additionalKeys[0]].additionalShow=!0))},backTo:function(e){"Report"===e?this.$router.push({name:e,query:{projectId:this.$route.query.projectId||"3001",rootId:this.$route.query.rootId||"3001"}}):"Page"===e?this.$router.push({name:e,params:{projectId:this.$route.query.rootId}}):this.$router.push({name:e,query:{projectId:this.$route.query.rootId||"3001"}})},nodeTreeMouseDown:function(e){this.lastPos={innerWidth:window.innerWidth,innerHeight:window.innerWidth,x:e.pageX,y:e.pageY},this.isMove=!0,window.addEventListener("mousemove",this.nodeTreeMouseMove),window.addEventListener("mouseup",this.nodeTreeMouseUp)},nodeTreeMouseMove:function(e){if(this.isMove){var t=this.$refs.nodeTree.offsetLeft,s=this.$refs.nodeTree.offsetTop,i=this.$refs.nodeTree.clientHeight,o=this.$refs.nodeTree.clientWidth,r=e.pageX-this.lastPos.x,n=e.pageY-this.lastPos.y;this.$refs.nodeTree.style.left="".concat(t+r<=0||t+r>=this.lastPos.innerWidth-o?t:t+r,"px"),this.$refs.nodeTree.style.top="".concat(s+n<=60||s+n>=this.lastPos.innerHeight-i?s:s+n,"px"),this.lastPos.x=e.pageX,this.lastPos.y=e.pageY}},nodeTreeMouseUp:function(e){this.isMove=!1,window.removeEventListener("mousemove",this.nodeTreeMouseMove),window.removeEventListener("mouseup",this.nodeTreeMouseUp)},requestAnswerRecord:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={projectId:this.projectId,recordId:this.$route.query.onRecord,token:this.$route.query["xAccessToken"]},e.next=3,n["default"].getAnswerRecord.apply(this,[t]);case 3:s=e.sent,s?this.answerRecord=s:this.$Message.error("获取做题记录失败");case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleRecordClick:function(e,t){if(e.preventDefault(),t.parentData.isRoot){e.stopPropagation();var s=t.nodeData.id;this.answer(2,"","",s),t.$el.animate([{background:"#D0DEF8"},{background:"#D0DEF8"},{background:"white"}],{duration:500})}}}},$=x,R=(s("9a5a"),s("3de65"),Object(w["a"])($,i,o,!1,null,null,null));R.options.__file="Question.vue";t["default"]=R.exports},"962a":function(e,t,s){},"9a5a":function(e,t,s){"use strict";var i=s("dfb1"),o=s.n(i);o.a},dfb1:function(e,t,s){}}]);
//# sourceMappingURL=chunk-4563bf28.ea553e86.js.map