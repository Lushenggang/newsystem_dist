(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b34c5698"],{"34ff":function(e,t,a){"use strict";var s=a("4a2e"),n=a.n(s);n.a},"4a2e":function(e,t,a){},"76bc":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Layout",[a("div",{attrs:{id:"qrcode"}},[a("h2",[e._v(e._s(e.title))]),a("img",{attrs:{src:e.qrCode}}),a("div",{staticClass:"show-msg"},[e._v(e._s(e.wxLoginMsg))])])])},n=[],i=a("7ded"),o={name:"weixin-login",props:{type:{type:String,required:!1,default:"login"},title:String},data:function(){return{wxUUID:"",qrCode:"",wxLoginMsg:"请用微信扫描二维码登录"}},created:function(){this.getQRCode()},methods:{getQRCode:function(){var e=this;Object(i["getQRCode"])().then(function(t){t.status;var a=t.result;e.wxUUID=a.wxUUID,e.qrCode=a.imgData,e.getWxCode(e.wxUUID)})},getWxCode:function(){var e=this;Object(i["getWxCode"])({uuid:this.wxUUID}).then(function(t){var a=t.result,s=t.status,n=t.msg;if(s&&405===s)e.wxLoginMsg=n,e.$emit("success",a.code);else if(500===s)e.getQRCode();else{s&&404===s&&(e.wxLoginMsg=n.title+", "+n.content);var i=setTimeout(function(){e.getWxCode(),clearTimeout(i)},2e3);console.log(a)}}).catch(function(t){var a=setTimeout(function(){e.getWxCode(),clearTimeout(a)},2e3);console.error(t)})}}},r=o,c=a("2877"),l=Object(c["a"])(r,s,n,!1,null,null,null);l.options.__file="weixin-login.vue";var u=l.exports;t["a"]=u},db45:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Layout",{staticClass:"account-setting-page"},[a("Row",{staticClass:"account-setting-title",attrs:{type:"flex",justify:"center"}},[a("h1",[e._v("账号设置")])]),a("Row",{staticClass:"account-setting-body",attrs:{type:"flex"}},[a("Form",{staticClass:"form-body",attrs:{model:e.userInfo}},[a("FormItem",{attrs:{label:"头像","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[e.userInfo.avatar?a("img",{staticClass:"avatar-image",attrs:{src:e.avatarUrl,alt:"avatar"},on:{click:e.uploadImage}}):a("div",{staticClass:"avatar-bomb",on:{click:e.uploadImage}},[e._v("点击上传头像")]),a("input",{ref:"avatarInput",staticStyle:{display:"none"},attrs:{id:"avatarInput",type:"file",accept:"image/*",name:"avatarInput"},on:{change:e.selectedImage}})])],1),a("FormItem",{attrs:{label:"姓名","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入姓名"},model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1)],1),a("FormItem",{attrs:{label:"绑定手机号","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{disabled:""},model:{value:e.userInfo.phone,callback:function(t){e.$set(e.userInfo,"phone",t)},expression:"userInfo.phone"}}),a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.bindPhoneModal=!0,e.refreshCaptcha()}}},[e._v("重新绑定手机号")])],1)],1),a("FormItem",{attrs:{label:"绑定邮箱","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{disabled:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}}),a("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.bindEmailModal=!0,e.refreshCaptcha()}}},[e._v("重新绑定邮箱")])],1)],1)],1),a("Button",{staticClass:"save-button",attrs:{type:"success",size:"small"},on:{click:e.saveUserInfo}},[e._v("保存")])],1),a("Modal",{attrs:{"mask-closable":!1},model:{value:e.bindPhoneModal,callback:function(t){e.bindPhoneModal=t},expression:"bindPhoneModal"}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("绑定手机号码")]),a("div",{staticClass:"modal-body"},[a("Form",[a("FormItem",{attrs:{label:"验证码","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入验证码"},model:{value:e.captcha,callback:function(t){e.captcha=t},expression:"captcha"}}),a("img",{attrs:{src:e.captchaUrl,alt:"验证码"},on:{click:e.refreshCaptcha}})],1)],1),a("FormItem",{attrs:{label:"手机号","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入手机号"},model:{value:e.settingInfo.phone,callback:function(t){e.$set(e.settingInfo,"phone",t)},expression:"settingInfo.phone"}}),a("Button",{attrs:{type:"primary",size:"small",loading:e.smsWait},on:{click:e.sendSms}},[e.smsWait?a("span",[e._v(e._s(e.smsWaitTime+"秒后重试"))]):a("span",[e._v("发送验证码")])])],1)],1),a("FormItem",{attrs:{label:"验证码","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入验证码"},model:{value:e.settingInfo.smsVcode,callback:function(t){e.$set(e.settingInfo,"smsVcode",t)},expression:"settingInfo.smsVcode"}})],1)],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{size:"small",type:"default"},on:{click:e.closeModal}},[e._v("取消")]),a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.confirmBind("phone")}}},[e._v("确定")])],1)]),a("Modal",{attrs:{"mask-closable":!1},model:{value:e.bindEmailModal,callback:function(t){e.bindEmailModal=t},expression:"bindEmailModal"}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("绑定邮箱")]),a("div",{staticClass:"modal-body"},[a("Form",[a("FormItem",{attrs:{label:"验证码","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入验证码"},model:{value:e.captcha,callback:function(t){e.captcha=t},expression:"captcha"}}),a("img",{attrs:{src:e.captchaUrl,alt:"验证码"},on:{click:e.refreshCaptcha}})],1)],1),a("FormItem",{attrs:{label:"邮箱","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入邮箱地址"},model:{value:e.settingInfo.email,callback:function(t){e.$set(e.settingInfo,"email",t)},expression:"settingInfo.email"}}),a("Button",{attrs:{type:"primary",size:"small",loading:e.emailCodeWait},on:{click:e.sendEmailVcode}},[e.emailCodeWait?a("span",[e._v(e._s(e.emailCodeWaitTime+"秒后重试"))]):a("span",[e._v("发送验证码")])])],1)],1),a("FormItem",{attrs:{label:"验证码","label-width":80}},[a("Row",{attrs:{type:"flex",gutter:16}},[a("Input",{attrs:{placeholder:"请输入验证码"},model:{value:e.settingInfo.emailVcode,callback:function(t){e.$set(e.settingInfo,"emailVcode",t)},expression:"settingInfo.emailVcode"}})],1)],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{size:"small",type:"default"},on:{click:e.closeModal}},[e._v("取消")]),a("Button",{attrs:{size:"small",type:"success"},on:{click:function(t){e.confirmBind("email")}}},[e._v("确定")])],1)]),a("Modal",{attrs:{"mask-closable":!1},model:{value:e.bindWxModal,callback:function(t){e.bindWxModal=t},expression:"bindWxModal"}},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("绑定微信")]),a("div",{staticClass:"modal-body bind-wx"},[a("bindWx")],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{size:"small",type:"default"},on:{click:e.closeModal}},[e._v("取消")])],1)])],1)},n=[],i=(a("7f7f"),a("96cf"),a("3040")),o=(a("a481"),a("cadf"),a("551c"),a("097d"),a("3f5e")),r=a("b61d"),c=a("8176"),l=a("76bc"),u={name:"account-setting",components:{bindWx:l["a"]},data:function(){return{bindPhoneModal:!1,bindEmailModal:!1,bindWxModal:!1,userInfo:{},captchaUrl:"",captcha:"",captchaUuid:"",smsWait:!1,smsWaitTime:60,emailCodeWait:!1,emailCodeWaitTime:60,emailCodeUuid:"",settingInfo:{phone:"",smsVcode:"",email:"",emailVcode:"",id:0}}},computed:{avatarUrl:function(){return this.userInfo.avatar?this.$avatarUrl.replace("avatarID",this.userInfo.avatar):null}},created:function(){this.userInfo=this.deepCopy(this.$store.getters["user/userInfo"]),this.initeSettingInfo()},methods:{uploadImage:function(){this.$refs.avatarInput.click()},selectedImage:function(e){var t=this,a=e.target.files[0];Object(o["uploadFile"])(a).then(function(e){t.userInfo.avatar=e.data,t.$store.commit("user/setUserInfo",t.userInfo)})},initeSettingInfo:function(){this.settingInfo={phone:"",smsVcode:"",email:"",emailVcode:"",id:this.userInfo.id}},validateCaptcha:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(r["validateCaptcha"])({captcha:this.captcha,uuid:this.captchaUuid});case 2:if(t=e.sent,t.response.success){e.next=9;break}return this.$Message.error("验证码错误，请重新输入！"),this.refreshCaptcha(),e.abrupt("return",!1);case 9:return e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),refreshCaptcha:function(){var e=this;Object(r["getCaptcha"])().then(function(t){e.captchaUrl="data:image;base64,".concat(t.data.image),e.captchaUuid=t.data.uuid})},sendEmailVcode:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.captcha.replace(/\s/g,"")){e.next=3;break}return this.$Message.warning("请输入验证码！"),e.abrupt("return");case 3:if(""!==(""+this.settingInfo.email).replace(/\s/g,"")){e.next=6;break}return this.$Message.warning("请输入邮箱地址！"),e.abrupt("return");case 6:return e.next=8,this.validateCaptcha();case 8:if(e.sent){e.next=10;break}return e.abrupt("return");case 10:this.emailCodeWait=!0,this.emailCodeWaitTime=60,t=setInterval(function(){a.emailCodeWaitTime<=1&&(clearInterval(t),a.emailCodeWait=!1),a.emailCodeWaitTime=a.emailCodeWaitTime-1},1e3),Object(r["sendEmailVcode"])({email:this.settingInfo.email,type:1,captcha:this.captcha,captchaUuid:this.captchaUuid}).then(function(e){e.response.success?a.$Message.success("邮件发送成功！"):a.$Message.error(e.response.msg)});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),sendSms:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(""!==this.captcha.replace(/\s/g,"")){e.next=3;break}return this.$Message.warning("请输入验证码！"),e.abrupt("return");case 3:if(""!==(""+this.settingInfo.phone).replace(/\s/g,"")){e.next=6;break}return this.$Message.warning("请输入手机号码！"),e.abrupt("return");case 6:return e.next=8,this.validateCaptcha();case 8:if(e.sent){e.next=10;break}return e.abrupt("return");case 10:this.smsWait=!0,this.smsWaitTime=60,t=setInterval(function(){a.smsWaitTime<=1&&(clearInterval(t),a.smsWait=!1),a.smsWaitTime=a.smsWaitTime-1},1e3),Object(r["sendSmsCode"])({phone:this.settingInfo.phone,type:3,captcha:this.captcha,captchaUuid:this.captchaUuid}).then(function(e){e.response.success?a.$Message.success("短信发送成功！"):a.$Message.error(e.response.msg)});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),confirmBind:function(e){var t=this;switch(e){case"phone":var a=this.settingInfo,s=a.id,n=a.phone,i=a.smsVcode;Object(c["savePhone"])({id:s,phone:n,smsVcode:i}).then(function(e){e.response.success?(t.userInfo.phone=t.settingInfo.phone,t.$Message.success("绑定成功！"),t.closeModal()):t.$Message.error(e.response.msg)});break;case"email":var o=this.settingInfo,r=o.id,l=o.email,u=o.emailVcode;Object(c["saveEmail"])({id:r,email:l,emailVcode:u}).then(function(e){e.response.success?(t.userInfo.email=t.settingInfo.email,t.$Message.success("绑定成功！"),t.closeModal()):t.$Message.error(e.response.msg)});break;default:break}},saveUserInfo:function(){var e=this,t=this.userInfo,a=t.avatar,s=t.id,n=t.name;Object(c["saveAccountInfo"])({avatar:a,id:s,name:n}).then(function(t){t.response.success&&e.$store.commit("user/setUserInfo",e.userInfo)})},closeModal:function(){this.bindPhoneModal=!1,this.bindEmailModal=!1,this.bindWxModal=!1,this.captcha="",this.initeSettingInfo()},bindWxSuccess:function(e){this.$Message.success("绑定成功！"),this.closeModal()}}},d=u,m=(a("34ff"),a("2877")),p=Object(m["a"])(d,s,n,!1,null,"3e74a96a",null);p.options.__file="AccountSetting.vue";t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-b34c5698.953cc072.js.map